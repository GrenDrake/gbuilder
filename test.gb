

function main() {
//    glk_setup();
    asm {
        streamstr "Hello World!";
        streamchar '\n';
    }
}

function glk_setup() {
    local res, mainWindow;

    asm {
        gestalt 4 2 res;
        jz res bad_start;

        setiosys 2 0;

        // glk_window_open
        copy sp 0; // rock
        copy sp 3; // wintype_TextBuffer
        copy sp 0;
        copy sp 0;
        copy sp 0;
        glk 34 5 mainWindow;
        jz mainWindow bad_start;
        
        // glk_set_window
        copy sp mainWindow;
        glk 47 1 0;
    }
    
    return;

//    bad_start:
    asm quit;
}